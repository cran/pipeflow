<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Advanced: How pipelines can modify themselves at runtime</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Advanced: How pipelines can modify
themselves at runtime</h1>


<div id="TOC">
<ul>
<li><a href="#changing-pipeline-parameters-at-runtime" id="toc-changing-pipeline-parameters-at-runtime">Changing pipeline
parameters at runtime</a></li>
<li><a href="#changing-the-pipeline-structure-at-runtime" id="toc-changing-the-pipeline-structure-at-runtime">Changing the
pipeline structure at runtime</a>
<ul>
<li><a href="#modify-a-step" id="toc-modify-a-step">Modify a
step</a></li>
<li><a href="#insert-and-remove-steps" id="toc-insert-and-remove-steps">Insert and remove steps</a></li>
</ul></li>
</ul>
</div>

<p>While the <code>pipeflow</code> package mostly aims to be an easy and
intuitive framework, it does provide some very advanced features and
interfaces that allow for a very flexible manipulation of the pipeline
objects. In this vignette we will introduce some of these features using
simple examples in order to give you an idea of what is possible.</p>
<div id="changing-pipeline-parameters-at-runtime" class="section level3">
<h3>Changing pipeline parameters at runtime</h3>
<p>Let’s first define a pipeline, which fits a linear model, checks it’s
residuals for normality using the Shapiro-Wilk test, and plots the
residuals.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(pipeflow)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>pip <span class="ot">&lt;-</span> <span class="fu">pipe_new</span>(<span class="st">&quot;my-pipeline&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    <span class="fu">pipe_add</span>(</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>        <span class="st">&quot;fit&quot;</span>,</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>        <span class="cf">function</span>(<span class="at">data =</span> <span class="sc">~</span>data, <span class="at">xVar =</span> <span class="st">&quot;x&quot;</span>, <span class="at">yVar =</span> <span class="st">&quot;y&quot;</span>)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>        {</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>            <span class="fu">lm</span>(<span class="fu">paste</span>(yVar, <span class="st">&quot;~&quot;</span>, xVar), <span class="at">data =</span> data)</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>        }</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>    <span class="fu">pipe_add</span>(</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>        <span class="st">&quot;residual_shapiro_p_value&quot;</span>,</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>        <span class="cf">function</span>(<span class="at">fit =</span> <span class="sc">~</span>fit)</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>        {</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>            residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit)</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>            p <span class="ot">&lt;-</span> <span class="fu">shapiro.test</span>(residuals)<span class="sc">$</span>p.value</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>            p</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>        },</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>        <span class="at">keepOut =</span> <span class="cn">TRUE</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>    <span class="fu">pipe_add</span>(</span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>        <span class="st">&quot;plot&quot;</span>,</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>        <span class="cf">function</span>(<span class="at">fit =</span> <span class="sc">~</span>fit, <span class="at">pointColor =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a>        {</span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>            data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>                <span class="at">fitted =</span> <span class="fu">predict</span>(fit),</span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a>                <span class="at">residuals =</span> <span class="fu">residuals</span>(fit)</span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a>            )</span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a>            <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> fitted, <span class="at">y =</span> residuals)) <span class="sc">+</span></span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a>                <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> pointColor) <span class="sc">+</span></span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a>                <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a>                <span class="fu">theme_minimal</span>()</span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a>        },</span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a>        <span class="at">keepOut =</span> <span class="cn">TRUE</span></span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a>    )</span></code></pre></div>
<p>So our pipeline looks like this</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>pip</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">#                        step depends    out keepOut                    group  state</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#                      &lt;char&gt;  &lt;list&gt; &lt;list&gt;  &lt;lgcl&gt;                   &lt;char&gt; &lt;char&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># 1:                     data         [NULL]   FALSE                     data    New</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co"># 2:                      fit    data [NULL]   FALSE                      fit    New</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co"># 3: residual_shapiro_p_value     fit [NULL]    TRUE residual_shapiro_p_value    New</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co"># 4:                     plot     fit [NULL]    TRUE                     plot    New</span></span></code></pre></div>
<p>and we can run it like this</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>pip<span class="sc">$</span><span class="fu">set_data</span>(airquality)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>pip<span class="sc">$</span><span class="fu">set_params</span>(<span class="fu">list</span>(<span class="at">xVar =</span> <span class="st">&quot;Ozone&quot;</span>, <span class="at">yVar =</span> <span class="st">&quot;Temp&quot;</span>))</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>pip<span class="sc">$</span><span class="fu">run</span>()<span class="sc">$</span><span class="fu">collect_out</span>()</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:54.570] Start run of &#39;my-pipeline&#39; pipeline:</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:54.571] Step 1/4 data</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:54.574] Step 2/4 fit</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:54.578] Step 3/4 residual_shapiro_p_value</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:54.581] Step 4/4 plot</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:54.590] Finished execution of steps.</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:54.591] Done.</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co"># $residual_shapiro_p_value</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co"># [1] 0.00022598</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co"># $plot</span></span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<p>Now let’s imagine, we want to change the color of the points in the
plot depending on the Shapiro-Wilk test result. The obvious way to do
this would be to change the <code>plot</code> step by passing the test
result to the <code>plot</code> step function and change the color
there.</p>
<p>However, here we are interested in another way that would keep the
<code>plot</code> function unchanged. For example, we could run the
pipeline a second time as follows:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="cf">if</span> (pip<span class="sc">$</span><span class="fu">get_out</span>(<span class="st">&quot;residual_shapiro_p_value&quot;</span>) <span class="sc">&lt;</span> <span class="fl">0.05</span>) {</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    pip<span class="sc">$</span><span class="fu">set_params</span>(<span class="fu">list</span>(<span class="at">pointColor =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>    pip<span class="sc">$</span><span class="fu">run</span>()<span class="sc">$</span><span class="fu">collect_out</span>()</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>}</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:54.762] Start run of &#39;my-pipeline&#39; pipeline:</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:54.763] Step 1/4 data - skip &#39;done&#39; step</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:54.764] Step 2/4 fit - skip &#39;done&#39; step</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:54.765] Step 3/4 residual_shapiro_p_value - skip &#39;done&#39; step</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:54.766] Step 4/4 plot</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:54.778] Finished execution of steps.</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:54.779] Done.</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co"># $residual_shapiro_p_value</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co"># [1] 0.00022598</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co"># $plot</span></span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<p>As was mentioned in another vignette, this solution is not ideal, as
it requires to run additional code outside the pipeline framework. To
solve this issue, we therefore basically have to set the parameter from
within the pipeline during execution. That is, we have to make the
pipeline aware of itself, which can be done by passing the pipeline
object as a parameter.</p>
<p>Let’s update the <code>residual_shapiro_p_value</code> step in the
above example.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>pip<span class="sc">$</span><span class="fu">replace_step</span>(</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>    <span class="st">&quot;residual_shapiro_p_value&quot;</span>,</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    <span class="cf">function</span>(</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>        <span class="at">fit =</span> <span class="sc">~</span>fit,</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>        <span class="at">.self =</span> <span class="cn">NULL</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>    ) {</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>        residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit)</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>        p <span class="ot">&lt;-</span> <span class="fu">shapiro.test</span>(residuals)<span class="sc">$</span>p.value</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(.self) <span class="sc">&amp;&amp;</span> p <span class="sc">&lt;</span> <span class="fl">0.05</span>) {</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>            .self<span class="sc">$</span><span class="fu">set_params</span>(<span class="fu">list</span>(<span class="at">pointColor =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>        }</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>        p</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>    },</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>    <span class="at">keepOut =</span> <span class="cn">TRUE</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>)</span></code></pre></div>
<p>Now we just have to make sure to set the <code>.self</code>
parameter.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>pip<span class="sc">$</span><span class="fu">set_data</span>(airquality)</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>pip<span class="sc">$</span><span class="fu">set_params</span>(<span class="fu">list</span>(<span class="at">xVar =</span> <span class="st">&quot;Ozone&quot;</span>, <span class="at">yVar =</span> <span class="st">&quot;Temp&quot;</span>, <span class="at">.self =</span> pip))</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>pip<span class="sc">$</span><span class="fu">run</span>()<span class="sc">$</span><span class="fu">collect_out</span>()</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.005] Start run of &#39;my-pipeline&#39; pipeline:</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.006] Step 1/4 data</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.009] Step 2/4 fit</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.012] Step 3/4 residual_shapiro_p_value</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.017] Step 4/4 plot</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.025] Finished execution of steps.</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.025] Done.</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co"># $residual_shapiro_p_value</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co"># [1] 0.00022598</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co"># $plot</span></span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<p>This simple “trick” opens up a wide range of possibilities for
pipeline modifications at runtime. As we will show in the next section,
this is not limited to changing parameters but can also be used to
modify the pipeline structure itself.</p>
</div>
<div id="changing-the-pipeline-structure-at-runtime" class="section level3">
<h3>Changing the pipeline structure at runtime</h3>
<p>Subsequently, the pipeline steps will be comprised only of very basic
functions in order to keep the examples simple. The focus here is on the
pipeline structure and how it can be modified at runtime.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>pip <span class="ot">&lt;-</span> <span class="fu">pipe_new</span>(<span class="st">&quot;my-pipeline&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="fu">pipe_add</span>(</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>        <span class="st">&quot;f1&quot;</span>,</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>        <span class="cf">function</span>(<span class="at">x =</span> <span class="sc">~</span>data) {</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>            x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>        }</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    <span class="fu">pipe_add</span>(</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>        <span class="st">&quot;f2&quot;</span>,</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>        <span class="cf">function</span>(<span class="at">x =</span> <span class="sc">~</span>f1) {</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>            x <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>        }</span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>    <span class="fu">pipe_add</span>(</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>        <span class="st">&quot;f3&quot;</span>,</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>        <span class="cf">function</span>(<span class="at">x =</span> <span class="sc">~</span>f2) {</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>            x <span class="sc">+</span> <span class="dv">3</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>        }</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>    )</span></code></pre></div>
<p>This pipeline just adds 1, 2, and 3 to the input data,
respectively.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>pip<span class="sc">$</span><span class="fu">set_data</span>(<span class="dv">1</span>)<span class="sc">$</span><span class="fu">run</span>()</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.216] Start run of &#39;my-pipeline&#39; pipeline:</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.218] Step 1/4 data</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.220] Step 2/4 f1</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.223] Step 3/4 f2</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.225] Step 4/4 f3</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.227] Finished execution of steps.</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.228] Done.</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>pip</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#      step depends    out keepOut  group  state</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#    &lt;char&gt;  &lt;list&gt; &lt;list&gt;  &lt;lgcl&gt; &lt;char&gt; &lt;char&gt;</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co"># 1:   data              1   FALSE   data   Done</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co"># 2:     f1    data      2   FALSE     f1   Done</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co"># 3:     f2      f1      4   FALSE     f2   Done</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co"># 4:     f3      f2      7   FALSE     f3   Done</span></span></code></pre></div>
<p>The <code>out</code> column in the table shows the output of each
step. Now let’s modify the last step of the pipeline such that if the
input is greater than 10, the pipeline will replace the last step with a
new step that now instead of <code>f2</code> references <code>f1</code>
and subtracts 3 from the input.</p>
<div id="modify-a-step" class="section level4">
<h4>Modify a step</h4>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>pip <span class="ot">&lt;-</span> <span class="fu">pipe_new</span>(<span class="st">&quot;my-pipeline&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    <span class="fu">pipe_add</span>(</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>        <span class="st">&quot;f1&quot;</span>,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>        <span class="cf">function</span>(<span class="at">x =</span> <span class="sc">~</span>data) {</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>            x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>        }</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>    <span class="fu">pipe_add</span>(</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>        <span class="st">&quot;f2&quot;</span>,</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>        <span class="cf">function</span>(<span class="at">x =</span> <span class="sc">~</span>f1, <span class="at">.self =</span> <span class="cn">NULL</span>)</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>        {</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>            <span class="cf">if</span> (x <span class="sc">&gt;</span> <span class="dv">10</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(.self))</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>            {</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>                .self<span class="sc">$</span><span class="fu">replace_step</span>(</span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>                    <span class="st">&quot;f3&quot;</span>,</span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>                    <span class="cf">function</span>(<span class="at">x =</span> <span class="sc">~</span>f1) {</span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>                        x <span class="sc">-</span> <span class="dv">3</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>                    }</span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a>                )</span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>            }</span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a>            x <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a>        }</span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a>    <span class="fu">pipe_add</span>(</span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a>        <span class="st">&quot;f3&quot;</span>,</span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a>        <span class="cf">function</span>(<span class="at">x =</span> <span class="sc">~</span>f2) {</span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a>            x <span class="sc">+</span> <span class="dv">3</span></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a>        }</span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a>    )</span></code></pre></div>
<p>If we run the pipeline as before, nothing will change.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>pip<span class="sc">$</span><span class="fu">set_params</span>(<span class="fu">list</span>(<span class="at">.self =</span> pip))</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>pip<span class="sc">$</span><span class="fu">set_data</span>(<span class="dv">1</span>)<span class="sc">$</span><span class="fu">run</span>()</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.327] Start run of &#39;my-pipeline&#39; pipeline:</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.328] Step 1/4 data</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.331] Step 2/4 f1</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.334] Step 3/4 f2</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.336] Step 4/4 f3</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.338] Finished execution of steps.</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.338] Done.</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>pip</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#      step depends    out keepOut  group  state</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#    &lt;char&gt;  &lt;list&gt; &lt;list&gt;  &lt;lgcl&gt; &lt;char&gt; &lt;char&gt;</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co"># 1:   data              1   FALSE   data   Done</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co"># 2:     f1    data      2   FALSE     f1   Done</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co"># 3:     f2      f1      4   FALSE     f2   Done</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co"># 4:     f3      f2      7   FALSE     f3   Done</span></span></code></pre></div>
<p>Now let’s try it with an input of 10.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>pip<span class="sc">$</span><span class="fu">set_data</span>(<span class="dv">10</span>)<span class="sc">$</span><span class="fu">run</span>()</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.386] Start run of &#39;my-pipeline&#39; pipeline:</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.387] Step 1/4 data</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.390] Step 2/4 f1</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.393] Step 3/4 f2</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.400] Step 4/4 f3</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.403] Finished execution of steps.</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.404] Done.</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>pip</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#      step depends    out keepOut  group  state</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#    &lt;char&gt;  &lt;list&gt; &lt;list&gt;  &lt;lgcl&gt; &lt;char&gt; &lt;char&gt;</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co"># 1:   data             10   FALSE   data   Done</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co"># 2:     f1    data     11   FALSE     f1   Done</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co"># 3:     f2      f1     13   FALSE     f2   Done</span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co"># 4:     f3      f1      8   FALSE     f3   Done</span></span></code></pre></div>
<p>We see that both the output of the pipeline and the dependencies of
the last step have changed.</p>
</div>
<div id="insert-and-remove-steps" class="section level4">
<h4>Insert and remove steps</h4>
<p>For our last example, instead of just replacing, we will go a bit
further to insert and remove steps. The pipeline definition is as
follows:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>pip <span class="ot">&lt;-</span> <span class="fu">pipe_new</span>(</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>        <span class="st">&quot;my-pipeline&quot;</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>    <span class="fu">pipe_add</span>(</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>        <span class="st">&quot;f1&quot;</span>,</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>        <span class="cf">function</span>(<span class="at">x =</span> <span class="sc">~</span>data) {</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>            x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>        }</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>    <span class="fu">pipe_add</span>(</span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>        <span class="st">&quot;f2&quot;</span>,</span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>        <span class="cf">function</span>(<span class="at">x =</span> <span class="sc">~</span>f1, <span class="at">.self =</span> <span class="cn">NULL</span>)</span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>        {</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a>            <span class="cf">if</span> (x <span class="sc">&gt;</span> <span class="dv">10</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(.self)) {</span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a>                .self<span class="sc">$</span><span class="fu">insert_after</span>(</span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a>                    <span class="at">afterStep =</span> <span class="st">&quot;f1&quot;</span>,</span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a>                    <span class="at">step =</span> <span class="st">&quot;f2a&quot;</span>,</span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a>                    <span class="cf">function</span>(<span class="at">x =</span> <span class="sc">~</span>f1) {</span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a>                        x <span class="sc">+</span> <span class="dv">21</span></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a>                    }</span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a>                )</span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a>                .self<span class="sc">$</span><span class="fu">insert_after</span>(</span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a>                    <span class="at">afterStep =</span> <span class="st">&quot;f2a&quot;</span>,</span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a>                    <span class="at">step =</span> <span class="st">&quot;f2b&quot;</span>,</span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a>                    <span class="cf">function</span>(<span class="at">x =</span> <span class="sc">~</span>f2a) {</span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a>                        x <span class="sc">+</span> <span class="dv">22</span></span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a>                    }</span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a>                )</span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a>                .self<span class="sc">$</span><span class="fu">replace_step</span>(</span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a>                    <span class="st">&quot;f3&quot;</span>,</span>
<span id="cb12-33"><a href="#cb12-33" tabindex="-1"></a>                    <span class="cf">function</span>(<span class="at">x =</span> <span class="sc">~</span>f2b) {</span>
<span id="cb12-34"><a href="#cb12-34" tabindex="-1"></a>                        x <span class="sc">+</span> <span class="dv">30</span></span>
<span id="cb12-35"><a href="#cb12-35" tabindex="-1"></a>                    }</span>
<span id="cb12-36"><a href="#cb12-36" tabindex="-1"></a>                )</span>
<span id="cb12-37"><a href="#cb12-37" tabindex="-1"></a>                .self<span class="sc">$</span><span class="fu">remove_step</span>(<span class="st">&quot;f2&quot;</span>)</span>
<span id="cb12-38"><a href="#cb12-38" tabindex="-1"></a>                <span class="fu">return</span>(.self)</span>
<span id="cb12-39"><a href="#cb12-39" tabindex="-1"></a>            }</span>
<span id="cb12-40"><a href="#cb12-40" tabindex="-1"></a>            x <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb12-41"><a href="#cb12-41" tabindex="-1"></a>        }</span>
<span id="cb12-42"><a href="#cb12-42" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb12-43"><a href="#cb12-43" tabindex="-1"></a></span>
<span id="cb12-44"><a href="#cb12-44" tabindex="-1"></a>    <span class="fu">pipe_add</span>(</span>
<span id="cb12-45"><a href="#cb12-45" tabindex="-1"></a>        <span class="st">&quot;f3&quot;</span>,</span>
<span id="cb12-46"><a href="#cb12-46" tabindex="-1"></a>        <span class="cf">function</span>(<span class="at">x =</span> <span class="sc">~</span>f2) {</span>
<span id="cb12-47"><a href="#cb12-47" tabindex="-1"></a>            x <span class="sc">+</span> <span class="dv">3</span></span>
<span id="cb12-48"><a href="#cb12-48" tabindex="-1"></a>        }</span>
<span id="cb12-49"><a href="#cb12-49" tabindex="-1"></a>    )</span></code></pre></div>
<p>Basically, if the input is greater than 10, we will insert two new
steps after <code>f1</code>, remove <code>f2</code>, and replace
<code>f3</code> with a new step that adds 30 to the input.</p>
<p>Also note that we return the pipeline object in this case. This is
important, because the pipeline’s <code>run</code> function has an
argument <code>recursive</code>, which by default is set to
<code>TRUE</code> and means that if a step returns a pipeline, the run
of the current pipeline is aborted and the returned pipeline is
re-run.</p>
<p>Let’s see the pipeline structure before running it.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>pip</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">#      step depends    out keepOut  group  state</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#    &lt;char&gt;  &lt;list&gt; &lt;list&gt;  &lt;lgcl&gt; &lt;char&gt; &lt;char&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co"># 1:   data         [NULL]   FALSE   data    New</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co"># 2:     f1    data [NULL]   FALSE     f1    New</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co"># 3:     f2      f1 [NULL]   FALSE     f2    New</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co"># 4:     f3      f2 [NULL]   FALSE     f3    New</span></span></code></pre></div>
<p>And now let’s run it with an input of 10.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>pip<span class="sc">$</span><span class="fu">set_params</span>(<span class="fu">list</span>(<span class="at">.self =</span> pip))</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>pip<span class="sc">$</span><span class="fu">set_data</span>(<span class="dv">10</span>)<span class="sc">$</span><span class="fu">run</span>()</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.534] Start run of &#39;my-pipeline&#39; pipeline:</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.535] Step 1/4 data</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.538] Step 2/4 f1</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.540] Step 3/4 f2</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.555] Abort pipeline execution and restart on new.</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.555] Start run of &#39;my-pipeline&#39; pipeline:</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.556] Step 1/5 data - skip &#39;done&#39; step</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.557] Step 2/5 f1 - skip &#39;done&#39; step</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.559] Step 3/5 f2a</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.561] Step 4/5 f2b</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.563] Step 5/5 f3</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.565] Finished execution of steps.</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="co"># INFO  [2024-12-01 13:40:55.566] Done.</span></span></code></pre></div>
<p>The log output shows the abort and re-run of the pipeline. Let’s see
the final structure and step outputs.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>pip</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co">#      step depends    out keepOut  group  state</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co">#    &lt;char&gt;  &lt;list&gt; &lt;list&gt;  &lt;lgcl&gt; &lt;char&gt; &lt;char&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co"># 1:   data             10   FALSE   data   Done</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co"># 2:     f1    data     11   FALSE     f1   Done</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co"># 3:    f2a      f1     32   FALSE    f2a   Done</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co"># 4:    f2b     f2a     54   FALSE    f2b   Done</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co"># 5:     f3     f2b     84   FALSE     f3   Done</span></span></code></pre></div>
<p>The final structure is as expected with the new steps inserted and
the old step removed. As mentioned before, this is just a simple example
to show the possibilities. I leave it to the user to come up with more
sensible and complex use cases.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
